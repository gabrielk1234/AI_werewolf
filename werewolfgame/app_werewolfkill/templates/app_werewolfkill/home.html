{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>狼人殺 - AI 對戰</title>

    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />


    <!-- 你自己的 CSS -->
    <link rel="stylesheet" href="{% static 'app_werewolfkill/style.css' %}" />
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="mb-4 text-center">狼人殺 - 單機 AI 對戰</h2>
    <div class="row g-4 mb-2">
        <!-- 聊天區 -->
        <div class="col-lg-8">
            <div class="card" style="height:600px">
                <div id="chat-box" class="border rounded p-3 mb-3"></div>
                <input type="text" id="user-input" class="form-control" placeholder="輸入你的發言" />
            </div>
        </div>

        <!-- 設定區 -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    遊戲設定
                </div>
                <div class="card-body">
                    <form>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input" id="god-mode"/>
                            <label class="form-check-label" for="god-mode">上帝視角</label>
                        </div>  
                        <button type="button" class="btn btn-primary w-100" id="start_game_btn">開始新遊戲</button>
                    </form>
                </div>
            </div>

            <div class="my-2"></div>

            <div class="card">
                <div class="card-header bg-primary text-white">
                    上帝視角
                </div>
                <div class="card-body" >
                    <div id="god-mode-box" class="border rounded p-3 mb-3" style="height:355px"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row d-flex justify-content-center">
        <!-- 檔案下載區 -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    游玩記錄下載
                </div>
                <div class="card-body">
                    
                </div>
            </div>
              
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS Bundle (包含 Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

  let socket;

  function connectSocket() {
    socket = new WebSocket('ws://' + window.location.host + '/ws/userinfo/');
    const chatbox = document.getElementById('chat-box');
    const godmode_box = document.getElementById('god-mode-box');
    socket.onopen = function() {
      console.log("WebSocket 已連線");
      chatbox.innerHTML += `<div class="message system"> 連綫成功，請點擊開始游戲！ </div>`;
    };
    
    socket.onmessage = function(e) {
      const data = JSON.parse(e.data);
      const isGodMode = document.getElementById('god-mode').checked;
      if (data.type == 'system') {
        chatbox.innerHTML += `<div class="message system">${data.value}</div>`;
      }
      else if ((data.type == 'god') && (isGodMode)) {
        godmode_box.innerHTML += `<div class="message god">${data.value}</div>`;
      }
      else if (data.type == 'player') {
        chatbox.innerHTML += `<div class="message player">${data.value}</div>`;
      }
      
    };

    socket.onclose = function() {
      console.log("連線關閉");
    };
  }

  connectSocket();

  // 綁定按鈕事件
  document.getElementById('start_game_btn').addEventListener('click', function() {
    if (socket && socket.readyState === WebSocket.OPEN) {
      socket.send('game_start');
    } else {
      console.log("WebSocket 尚未連線");
    }
  });
  </script>
</body>
</html>
